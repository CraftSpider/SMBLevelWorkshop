<?xml version="1.0" encoding="utf-8" ?>
<specSheet>
    <spec id="replayFormat" name="SMB 1 (Uncompressed) Replay Format" linkImage="Link.png">
		<note>
            Thanks to PistonMiner for figuring out he uncompressed format: https://github.com/PistonMiner/smb-tools
        </note>
        <note>
            The initial gamecube header is being ignored here. Compressed replay data begins at 0x2090 in a .gci
        </note>
		<note>
           Data after the header is separated into 24 blocks of size 0xF00. One byte from each block is used per frame.
        </note>
		<note>Per Frame Flag bit values (bit 0 is the least significant bit):</note>
    <note>• bit 0: Nothing?</note>
    <note>• bit 1: Nothing?</note>
    <note>• bit 2: Sparks on/off</note>
    <note>• bit 3: Nothing?</note>
    <note>• bit 4: Ball on/off</note>
    <note>• bit 5: Chest bump</note>
    <note>• bit 6: Falling sparkles on/off</note>
    <note>• bit 7: Nothing?</note>
    <note>• bit 8: Nothing?</note>
    <note>• bit 9: Nothing?</note>
    <note>• bit 10: Nothing?</note>
    <note>• bit 11: Nothing?</note>
    <note>• bit 12: Nothing?</note>
    <note>• bit 13: Nothing?</note>
    <note>• bit 14: Waaa and Chest Bump?</note>
    <note>• bit 15: Punch head (right fist, then left fist)</note>
    <note>• bit 16: Nothing?</note>
    <note>• bit 17: Nothing?</note>
    <note>• bit 18: Nothing</note>
    <note>• bit 18: Nothing?</note>
    <note>• bit 19: Nothing?</note>
    <note>• bit 20: Nothing?</note>
    <note>• bit 21: Nothing?</note>
    <note>• bit 22: Nothing?</note>
    <note>• bit 23: Nothing?</note>
    <note>• bit 24: Nothing?</note>
    <note>• bit 25: Nothing?</note>
    <note>• bit 26: Nothing?</note>
    <note>• bit 27: buaa bounce sfx thing (plays new instance every single frame this bit is set)</note>
    <note>• bit 28: Getting punched sound effect (fist not monkey pain, plays new instance every single frame this bit is set)</note>
    <note>• bit 29: Some bounce thing? (plays new instance every single frame this bit is set)</note>
    <note>• bit 30: Deeper bounce thing? (plays new instance every single frame this bit is set)</note>
    <note>• bit 31: Like a rock hitting a door (plays new instance every single frame this bit is set)</note>
		<flag id="f" info="4 byte float" image="Float32.png"/>
		<flag id="i" info="4 byte integer" image="Int32.png"/>
        <flag id="s" info="2 byte short" image="Short16.png"/>
        <flag id="b" info="1 byte" image="Byte8.png"/>
        <flag id="u" info="Unknown" image="Unknown.png"/>

        <section id="header" name="Header Section (Offset 0x0)">
            <entry length="2" flags="s" info="Flags (Win: 0x1; Fallout: 0x2; Timeout: 0x4; Bonus: 0x8; All Bananas (only used if also Bonus?): 0x80)"/>
            <entry length="1" flags="b" info="Level Id"/>
            <entry length="1" flags="b" info="Level Difficulty"/>
            <entry length="1" flags="b" info="Level Floor"/>
            <entry length="1" flags="b" info="Monkey (Aiai: 0x0; Meemee: 0x1; Baby: 0x2; Gongon: 0x3)"/>
            <entry length="2" flags="s" info="unk_06 (Maybe padding?)"/>
            <entry length="4" flags="i" info="unk_08"/>
            <entry length="4" flags="i" info="unk_0c"/>
            <entry length="4" flags="i" info="Score Points"/>
            <entry length="4" flags="i" info="unk_14"/>
            <entry length="2" flags="s" info="Level Max Time (ex: 60 seconds in frames)"/>
			<entry length="2" flags="s" info="Replay Total Time (frames til tape breaks?)"/>
			<entry length="2" flags="s" info="Score Time Remaining (frames until loop?)"/>
			<entry length="2" flags="s" info="unk_1E (Blue Goal: 0x0; Not Blue Goal: 0x1)"/>
			<entry length="4" flags="i" info="Time With Score"/>
			<entry length="4" flags="f" info="unk_24"/>
			<entry length="4" flags="f" info="unk_28"/>
			<entry length="4" flags="f" info="unk_2C"/>
			<entry length="4" flags="i" info="unk_30"/>
			<entry length="4" flags="i" info="Duplicate of Replay Total Time"/>
			<entry length="4" flags="f" info="Start Position X"/>
			<entry length="4" flags="f" info="Start Position Y"/>
			<entry length="4" flags="f" info="Start Position Z"/>
        </section>
		
		<section id="frameData" name="Frame Data (Each byte is in a serpate block of length 0xF00. One byte in each block is used per frame)">
            <entry length="1" flags="b" info="Delta X from last frame (lower byte) (Divide combined value by 16,383 to get the true float value)"/>
			<entry length="1" flags="b" info="Delta X from last frame (upper byte) (Divide combined value by 16,383 to get the true float value)"/>
			<entry length="1" flags="b" info="Delta Y from last frame (lower byte) (Divide combined value by 16,383 to get the true float value)"/>
			<entry length="1" flags="b" info="Delta Y from last frame (upper byte) (Divide combined value by 16,383 to get the true float value)"/>
			<entry length="1" flags="b" info="Delta Z from last frame (lower byte) (Divide combined value by 16,383 to get the true float value)"/>
			<entry length="1" flags="b" info="Delta Z from last frame (upper byte) (Divide combined value by 16,383 to get the true float value)"/>
			<entry length="1" flags="b" info="Ball rotation X (lower byte)"/>
			<entry length="1" flags="b" info="Ball rotation X (upper byte)"/>
			<entry length="1" flags="b" info="Ball rotation Y (lower byte)"/>
			<entry length="1" flags="b" info="Ball rotation Y (upper byte)"/>
			<entry length="1" flags="b" info="Ball rotation Z (lower byte)"/>
			<entry length="1" flags="b" info="Ball rotation Z (upper byte)"/>
			<entry length="1" flags="b" info="Spark X direction (Multiply by 256 to get the true float value)"/>
			<entry length="1" flags="b" info="Spark Y direction (Multiply by 256 to get the true float value)"/>
			<entry length="1" flags="b" info="Spark Z direction (Multiply by 256 to get the true float value)"/>
			<entry length="1" flags="b" info="spark intensity (Divide by 127 to get the true float value)"/>
			<entry length="1" flags="b" info="Flags (lower byte)"/>
			<entry length="1" flags="b" info="Flags (lower-middle byte)"/>
			<entry length="1" flags="b" info="Flags (upper-middle byte)"/>
			<entry length="1" flags="b" info="Flags (upper byte)"/>
			<entry length="1" flags="b" info="Stage tilt X (lower byte)"/>
			<entry length="1" flags="b" info="Stage tilt X (upper byte)"/>
			<entry length="1" flags="b" info="Stage tilt Y (lower byte)"/>
			<entry length="1" flags="b" info="Stage tilt Y (upper byte)"/>
        </section>
    </spec>
</specSheet>
