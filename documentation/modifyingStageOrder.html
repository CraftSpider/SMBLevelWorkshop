<h1>Mofifying Stage Order</h1>

<h3>Story Mode</h3>

<p>
	Stage orders and their difficulties are stored within <code>/mkb2.main_loop.rel</code>.
	At offset <code>0x0020B448</code>, there is a list of stages and their difficulties.
</p>

<p>
	2 bytes are used to store the level ID, then 2 bytes are used to store the difficulty.
	This 4 byte segment loops 100x for all story mode levels.
</p>

<table class="table">
	<tr>
		<th>Stage ID</th>
		<th>Stage Difficulty (0 / <code>0x00</code> - 10 / <code>0x0A</code>)</th>
		<th>Description</th>
	</tr>
	<tr>
		<td><code>00 C9</code></td>
		<td><code>00 01</code></td>
		<td>World 1 Stage 1 - Difficulty: 1</td>
	</tr>
	<tr>
		<td><code>00 CA</code></td>
		<td><code>00 02</code></td>
		<td>World 1 Stage 2 - Difficulty: 2</td>
	</tr>
	<tr>
		<td>...</td>
		<td>...</td>
		<td>...</td>
	</tr>
	<tr>
		<td><code>00 06</code></td>
		<td><code>00 02</code></td>
		<td>World 1 Stage 10 - Difficulty: 2</td>
	</tr>
	<tr>
		<td><code>00 07</code></td>
		<td><code>00 02</code></td>
		<td>World 2 Stage 1 - Difficulty: 2</td>
	</tr>
	<tr>
		<td><code>00 08</code></td>
		<td><code>00 05</code></td>
		<td>World 2 Stage 2 - Difficulty: 5</td>
	</tr>
	<tr>
		<td>...</td>
		<td>...</td>
		<td>...</td>
	</tr>
	<tr>
		<td><code>01 5E</code></td>
		<td><code>00 06</code></td>
		<td>World 10 Stage 10 - Difficulty: 6</td>
	</tr>
</table>

<h4>Default orders and difficulties</h4>

<p>
	Each block of 10 lines is a world.<br />
	The first 2 bytes in each line store the stage ID.<br />
	The last 2 bytes in each line store the difficulty.
</p>

<button data-toggle="collapse" data-target="#story-mode-order-hex" class="btn btn-default">Show / Hide</button>

<pre id="story-mode-order-hex" class="collapse"><code>00 C9 00 01
00 CA 00 02
00 CB 00 01
00 CC 00 02
00 01 00 06
00 02 00 03
00 03 00 02
00 04 00 08
00 05 00 06
00 06 00 02

00 07 00 02
00 08 00 05
00 09 00 03
00 0A 00 06
00 0B 00 07
00 0C 00 03
00 0D 00 07
00 0E 00 06
00 0F 00 08
00 10 00 06

00 E7 00 03
00 E8 00 08
00 E9 00 06
00 EA 00 06
00 EB 00 04
00 EC 00 03
00 ED 00 03
00 EE 00 08
00 EF 00 03
00 11 00 03

00 12 00 02
00 13 00 08
00 14 00 05
00 15 00 01
00 16 00 06
00 17 00 09
00 18 00 06
00 19 00 08
00 1A 00 08
00 1B 00 0A

00 1C 00 03
00 1D 00 07
00 1E 00 04
00 1F 00 08
00 20 00 03
00 21 00 05
00 22 00 02
00 23 00 06
00 24 00 0A
00 25 00 04

00 26 00 08
00 27 00 08
00 28 00 05
00 29 00 05
00 2A 00 05
00 2B 00 09
00 2C 00 09
00 2D 00 05
00 2E 00 09
00 2F 00 02

01 19 00 04
01 1A 00 05
01 1B 00 07
01 1C 00 06
01 1D 00 04
01 1E 00 08
01 1F 00 09
01 20 00 09
01 21 00 0A
00 30 00 05

00 31 00 09
00 32 00 08
00 33 00 0A
00 34 00 09
00 35 00 08
00 36 00 09
00 37 00 0A
00 38 00 0A
00 39 00 06
00 3A 00 07

00 3B 00 0A
00 3C 00 0A
00 3D 00 08
00 3E 00 09
00 3F 00 0A
00 40 00 07
00 41 00 08
00 42 00 08
00 43 00 06
00 44 00 0A

01 55 00 08
01 56 00 09
01 57 00 09
01 58 00 09
01 59 00 08
01 5A 00 09
01 5B 00 07
01 5C 00 08
01 5D 00 09
01 5E 00 06
</code></pre>

<h3>Challenge Mode</h3>

<p>
	Stage orders and their extra data are stored within <code>/mkb2.main_loop.rel</code>.
</p>

<pre><code>-The challenge mode entries start at 0x2075B0
-A difficulty is made of a list of entries followed by an end of entries
-A twelve block is 48 zero bytes (12 zero words) while a five block is 20 zero bytes
-Thanks to miss mecha and bobjrsenior for their work in challenge mode entry stuff

Each level entry begins with
0x0 - 02000000
0x4 - 0000 `append` (stg id)

Normal entry (0x54 = 84 bytes)
0x8 thru 0x37 - zeroes? (0x30 = 48 zeroes)
0x38 - 01000000
0x3C - 00000001
0x40 thru 0x53 - zeroes? (0x14 = 20 zeroes)

Final level entry (0x54 = 84 bytes)
0x8 thru 0x37 - zeroes? (0x30 = 48 zeroes)
0x38 - 01020000
0x3C - 00000000
0x40 thru 0x53 - zeroes? (0x14 = 20 zeroes)

Entry with different time (0x70 = 112 bytes)
0x8 thru 0x1B - zeroes? (0x14 = 20 zeroes)
0x1C - 02010000
0x20 - 0000 `append` (time alloted)
0x24 thru 0x53 - zeroes? (0x30 = 48 zeroes)
0x54 - 01000000
0x58 - 00000001
0x5C thru 0x6F - zeroes? (0x14 = 20 zeroes)


Normal entry (after the stage id part)
Twelve block
01000000
00000001
Five block

Final level entry
Twelve block
01020000
00000000
Five block

Entry with different time
Five block
02010000
0000 ++ time alloted
Twelve block
01000000
00000001
Five block

Entry with green goal (SMB2)
Twelve block
00020000
00000000
Five block
01000000
00000001
Twelve block
00020000
00000001
Five block
01000000
00000002
Five block

SMB1 Expert 2
Five block
02010000
00000708
Twelve block
00020000
00000042 --Blue goal id for SMB1 and in lz
Five block
01000000
00000001
Twelve block
00020000
00000052 --Red goal
Five block
01000000
00000003
Five block


End of entries
0x0 - 03000000
0x4 thru 0x1B - zeroes?


Free Fall, Jump Machine, and most other levels with green/red goals are not normal. They have the extra goal data
Coin Slots, Switches, Passage, and maybe others have normal data, despite having a green goal


General format for entry (psuedocode)
print 02000000
print (0000 + stg id)
if (timeAlotted != 60.00 sec) {
	fiveBlock()
	print (0000 + time alotted)
}
if (isLastLevel) {
	twelveBlock()
	print 01020000
	print 00000000
}
else if (goals.length == 1) {
	twelveBlock()
	print 01000000
	print (000000 + goals[0].jumpDistance)
}
else {
	for (goal in goals) {
		twelveBlock()
		print 00020000
		print 000000 + goal.type (0x00 for blue, 0x01 for green, 0x02 for red in SMB2)
		fiveBlock()
		print 01000000
		print 000000 + goal.jumpDistance
	}
}
fiveBlock()
	

2C7874 table (this table tells us the first entry of each difficulty
3E440105
00033550 -- Beginner 
00040105 (Connector)
000338B4 -- Advanced
00040105
... so on

Entries!
3550 BE (at 2C787A)
38B4 AD (at 2C7882)
45D4 EX
5C94 BEEX
6068 ADEX
63E8 EXEX
6880 MA
6C54 MAEX
6C54
71CC Unused difficulty (intended to be a Super Master?)
71CC
71CC
</code></pre>

-TwixNinja411

